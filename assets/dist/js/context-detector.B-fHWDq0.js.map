{"version":3,"file":"context-detector.B-fHWDq0.js","sources":["../../../source/js/context-detector.ts"],"sourcesContent":["class ClientTypeChecker {\n\tprivate timedOut: boolean = false;\n\tprivate img: HTMLImageElement = new Image();\n\tprivate timer: number | null = null;\n\n\tconstructor(private config: brokenLinkContextDetectionData) {\n\t\tthis.initializeCheck();\n\t}\n\n\t// Initialize the client type check\n\tprivate initializeCheck(): void {\n\t\tconst storedResult = sessionStorage.getItem('brokenLinkClientType');\n\n\t\tif (storedResult) {\n\t\t\tthis.applyStoredResult(storedResult);\n\t\t} else {\n\t\t\tthis.setTimer();\n\t\t\tthis.loadImage();\n\t\t}\n\t}\n\n\t// Apply a stored result\n\tprivate applyStoredResult(result: string): void {\n\t\tif (result === 'internal') {\n\t\t\tthis.setInternalClient();\n\t\t} else if (result === 'external') {\n\t\t\tthis.setExternalClient();\n\t\t}\n\t}\n\n\t// Set a timeout for image loading\n\tprivate setTimer(): void {\n\t\tthis.timer = window.setTimeout(() => {\n\t\t\tthis.timedOut = true;\n\t\t\tthis.cancelImageLoad();\n\t\t\tthis.setExternalClient();\n\t\t}, this.config.checkTimeout);\n\t}\n\n\t// Load the image and handle success or failure\n\tprivate loadImage(): void {\n\t\tthis.img.onload = this.handleImageLoad;\n\t\tthis.img.onerror = this.handleImageError;\n\t\tthis.img.src = this.config.checkUrl;\n\t}\n\n\t// Handle successful image load (internal client)\n\tprivate handleImageLoad = (): void => {\n\t\tif (!this.timedOut) {\n\t\t\tthis.clearTimer();\n\t\t\tthis.setInternalClient();\n\t\t}\n\t};\n\n\t// Handle image load error (external client)\n\tprivate handleImageError = (): void => {\n\t\tif (!this.timedOut) {\n\t\t\tthis.clearTimer();\n\t\t\tthis.setExternalClient();\n\t\t}\n\t};\n\n\t// Clear the timer if image loads or errors before timeout\n\tprivate clearTimer(): void {\n\t\tif (this.timer) {\n\t\t\tclearTimeout(this.timer);\n\t\t\tthis.timer = null;\n\t\t}\n\t}\n\n\t// Cancel image loading on timeout\n\tprivate cancelImageLoad(): void {\n\t\tthis.img.src = ''; // Cancel image loading\n\t}\n\n\t// Mark as internal client\n\tprivate setInternalClient(): void {\n\t\tdocument.dispatchEvent(new CustomEvent('brokenLinkContextDetectionInternal'));\n\t\tdocument.body.classList.add(this.config.successClass);\n\t\tsessionStorage.setItem('brokenLinkClientType', 'internal');\n\t}\n\n\t// Mark as external client\n\tprivate setExternalClient(): void {\n\t\t// Execute custom event\n\t\tdocument.dispatchEvent(new CustomEvent('brokenLinkContextDetectionExternal'));\n\t\tdocument.body.classList.add(this.config.failedClass);\n\t\tthis.applyDomainRestrictions();\n\t\tsessionStorage.setItem('brokenLinkClientType', 'external');\n\t}\n\n\t// Apply domain restrictions to domains in the domain list\n\tprivate applyDomainRestrictions(): void {\n\t\tthis.config.domains.forEach((domain) => {\n\t\t\tconst elements = document.querySelectorAll(`a[href*=\"${domain}\"]`);\n\t\t\telements.forEach((element) => {\n\t\t\t\tthis.addUnavailableClass(element);\n\t\t\t\tthis.preventDefaultOnClick(element);\n\n\t\t\t\tif (this.config.isToolTipActive) {\n\t\t\t\t\tthis.addTooltip(element);\n\t\t\t\t}\n\n\t\t\t\tif (this.config.isModalActive) {\n\t\t\t\t\tthis.addModalAttributes(element);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.reindexModals();\n\t}\n\n\tprivate addUnavailableClass(element: Element): void {\n\t\telement.classList.add('broken-link-detector-link-is-unavailable');\n\t}\n\n\tprivate preventDefaultOnClick(element: Element): void {\n\t\telement.addEventListener('click', (event) => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t}\n\n\tprivate addTooltip(element: Element): void {\n\t\telement.setAttribute('data-tooltip', this.config.tooltip);\n\t}\n\n\tprivate addModalAttributes(element: Element): void {\n\t\telement.setAttribute('data-open', 'modal-broken-link');\n\t\telement.addEventListener('click', () => {\n\t\t\tconst modalButton = document.getElementById('modal-broken-link-button');\n\t\t\tif (modalButton) {\n\t\t\t\tmodalButton.setAttribute('href', element.getAttribute('href') || '#linknotfound');\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate reindexModals(): void {\n\t\tdocument.dispatchEvent(new CustomEvent('reindexModals'));\n\t}\n}\n\n// Interfaces\ninterface brokenLinkContextDetectionData {\n\tisEnabled: string; // Assuming '1' or '0' as string, change to `boolean` if converted\n\tcheckUrl: string;\n\tcheckTimeout: number; // or number if itâ€™s parsed as a number\n\tdomains: string[];\n\ttooltip: string;\n\tsuccessClass: string;\n\tfailedClass: string;\n\tisToolTipActive: boolean;\n\tisModalActive: boolean;\n}\n\ndeclare global {\n\tinterface Window {\n\t\tbrokenLinkContextDetectionData?: brokenLinkContextDetectionData;\n\t}\n}\n\n// @ts-expect-error Function to initialize client type checker\nexport function initializeClientTypeChecker(brokenLinkContextDetectionData): void {\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\tnew ClientTypeChecker(brokenLinkContextDetectionData);\n\t});\n}\n// @ts-expect-error\ninitializeClientTypeChecker(brokenLinkContextDetectionData);\n"],"names":["brokenLinkContextDetectionData"],"mappings":"gHAAA,MAAM,mBAAN,MAAM,kBAAkB,CAKvB,YAAoB,OAAwC,CAAxC,KAAA,OAAA,OACnB,KAAK,gBAAA,CACN,CANQ,SAAoB,GACpB,IAAwB,IAAI,MAC5B,MAAuB,KAOvB,iBAAwB,CAC/B,MAAM,aAAe,eAAe,QAAQ,sBAAsB,EAE9D,aACH,KAAK,kBAAkB,YAAY,GAEnC,KAAK,SAAA,EACL,KAAK,UAAA,EAEP,CAGQ,kBAAkB,OAAsB,CAC3C,SAAW,WACd,KAAK,kBAAA,EACK,SAAW,YACrB,KAAK,kBAAA,CAEP,CAGQ,UAAiB,CACxB,KAAK,MAAQ,OAAO,WAAW,IAAM,CACpC,KAAK,SAAW,GAChB,KAAK,gBAAA,EACL,KAAK,kBAAA,CACN,EAAG,KAAK,OAAO,YAAY,CAC5B,CAGQ,WAAkB,CACzB,KAAK,IAAI,OAAS,KAAK,gBACvB,KAAK,IAAI,QAAU,KAAK,iBACxB,KAAK,IAAI,IAAM,KAAK,OAAO,QAC5B,CAGQ,gBAAkB,WAAY,CAChC,KAAK,WACT,KAAK,WAAA,EACL,KAAK,kBAAA,EAEP,EAL0B,mBAQlB,iBAAmB,WAAY,CACjC,KAAK,WACT,KAAK,WAAA,EACL,KAAK,kBAAA,EAEP,EAL2B,oBAQnB,YAAmB,CACtB,KAAK,QACR,aAAa,KAAK,KAAK,EACvB,KAAK,MAAQ,KAEf,CAGQ,iBAAwB,CAC/B,KAAK,IAAI,IAAM,EAChB,CAGQ,mBAA0B,CACjC,SAAS,cAAc,IAAI,YAAY,oCAAoC,CAAC,EAC5E,SAAS,KAAK,UAAU,IAAI,KAAK,OAAO,YAAY,EACpD,eAAe,QAAQ,uBAAwB,UAAU,CAC1D,CAGQ,mBAA0B,CAEjC,SAAS,cAAc,IAAI,YAAY,oCAAoC,CAAC,EAC5E,SAAS,KAAK,UAAU,IAAI,KAAK,OAAO,WAAW,EACnD,KAAK,wBAAA,EACL,eAAe,QAAQ,uBAAwB,UAAU,CAC1D,CAGQ,yBAAgC,CACvC,KAAK,OAAO,QAAQ,QAAS,QAAW,CACtB,SAAS,iBAAiB,YAAY,MAAM,IAAI,EACxD,QAAS,SAAY,CAC7B,KAAK,oBAAoB,OAAO,EAChC,KAAK,sBAAsB,OAAO,EAE9B,KAAK,OAAO,iBACf,KAAK,WAAW,OAAO,EAGpB,KAAK,OAAO,eACf,KAAK,mBAAmB,OAAO,CAEjC,CAAC,CACF,CAAC,EAED,KAAK,cAAA,CACN,CAEQ,oBAAoB,QAAwB,CACnD,QAAQ,UAAU,IAAI,0CAA0C,CACjE,CAEQ,sBAAsB,QAAwB,CACrD,QAAQ,iBAAiB,QAAU,OAAU,CAC5C,MAAM,eAAA,CACP,CAAC,CACF,CAEQ,WAAW,QAAwB,CAC1C,QAAQ,aAAa,eAAgB,KAAK,OAAO,OAAO,CACzD,CAEQ,mBAAmB,QAAwB,CAClD,QAAQ,aAAa,YAAa,mBAAmB,EACrD,QAAQ,iBAAiB,QAAS,IAAM,CACvC,MAAM,YAAc,SAAS,eAAe,0BAA0B,EAClE,aACH,YAAY,aAAa,OAAQ,QAAQ,aAAa,MAAM,GAAK,eAAe,CAElF,CAAC,CACF,CAEQ,eAAsB,CAC7B,SAAS,cAAc,IAAI,YAAY,eAAe,CAAC,CACxD,CACD,EA3IwB,+CAAxB,IAAM,kBAAN,mBAiKO,SAAS,4BAA4BA,gCAAsC,CACjF,SAAS,iBAAiB,mBAAoB,IAAM,CACnD,IAAI,kBAAkBA,+BAA8B,CACrD,CAAC,CACF,CAJgB,kEAMhB,4BAA4B,8BAA8B"}
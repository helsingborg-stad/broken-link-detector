{"version":3,"file":"js/context-detector.3361defc466a8be32f8f.js","mappings":"yBAGA,MAAMA,EACF,WAAAC,CAAYC,GACRC,KAAKD,OAASA,EACdC,KAAKC,UAAW,EAChBD,KAAKE,IAAM,IAAIC,MACfH,KAAKI,MAAQ,KAEbJ,KAAKK,gBAAkB,KACdL,KAAKC,WACND,KAAKM,aACLN,KAAKO,sBAIbP,KAAKQ,iBAAmB,KACfR,KAAKC,WACND,KAAKM,aACLN,KAAKS,sBAGbT,KAAKU,iBACT,CAEA,eAAAA,GACI,MAAMC,EAAeC,eAAeC,QAAQ,wBACxCF,EACAX,KAAKc,kBAAkBH,IAGvBX,KAAKe,WACLf,KAAKgB,YAEb,CAEA,iBAAAF,CAAkBG,GACC,aAAXA,EACAjB,KAAKO,oBAEW,aAAXU,GACLjB,KAAKS,mBAEb,CAEA,QAAAM,GACIf,KAAKI,MAAQc,OAAOC,WAAW,KAC3BnB,KAAKC,UAAW,EAChBD,KAAKoB,kBACLpB,KAAKS,qBACNT,KAAKD,OAAOsB,aACnB,CAEA,SAAAL,GACIhB,KAAKE,IAAIoB,OAAStB,KAAKK,gBACvBL,KAAKE,IAAIqB,QAAUvB,KAAKQ,iBACxBR,KAAKE,IAAIsB,IAAMxB,KAAKD,OAAO0B,QAC/B,CAEA,UAAAnB,GACQN,KAAKI,QACLsB,aAAa1B,KAAKI,OAClBJ,KAAKI,MAAQ,KAErB,CAEA,eAAAgB,GACIpB,KAAKE,IAAIsB,IAAM,EACnB,CAEA,iBAAAjB,GACIoB,SAASC,cAAc,IAAIC,YAAY,uCACvCF,SAASG,KAAKC,UAAUC,IAAIhC,KAAKD,OAAOkC,cACxCrB,eAAesB,QAAQ,uBAAwB,WACnD,CAEA,iBAAAzB,GAEIkB,SAASC,cAAc,IAAIC,YAAY,uCACvCF,SAASG,KAAKC,UAAUC,IAAIhC,KAAKD,OAAOoC,aACxCnC,KAAKoC,0BACLxB,eAAesB,QAAQ,uBAAwB,WACnD,CAEA,uBAAAE,GACIpC,KAAKD,OAAOsC,QAAQC,QAAQC,IACPZ,SAASa,iBAAiB,YAAYD,OAC9CD,QAAQG,IACbzC,KAAK0C,oBAAoBD,GACzBzC,KAAK2C,sBAAsBF,GACvBzC,KAAKD,OAAO6C,iBACZ5C,KAAK6C,WAAWJ,GAEhBzC,KAAKD,OAAO+C,eACZ9C,KAAK+C,mBAAmBN,OAIpCzC,KAAKgD,eACT,CACA,mBAAAN,CAAoBD,GAChBA,EAAQV,UAAUC,IAAI,2CAC1B,CACA,qBAAAW,CAAsBF,GAClBA,EAAQQ,iBAAiB,QAAUC,IAC/BA,EAAMC,kBAEd,CACA,UAAAN,CAAWJ,GACPA,EAAQW,aAAa,eAAgBpD,KAAKD,OAAOsD,QACrD,CACA,kBAAAN,CAAmBN,GACfA,EAAQW,aAAa,YAAa,qBAClCX,EAAQQ,iBAAiB,QAAS,KAC9B,MAAMK,EAAc3B,SAAS4B,eAAe,4BACxCD,GACAA,EAAYF,aAAa,OAAQX,EAAQe,aAAa,SAAW,kBAG7E,CACA,aAAAR,GACIrB,SAASC,cAAc,IAAIC,YAAY,iBAC3C,GAGJ,SAAqC4B,GACjC9B,SAASsB,iBAAiB,mBAAoB,KAC1C,IAAIpD,EAAkB4D,IAE9B,CAEAC,CAA4BD,+B","sources":["webpack://@helsingborg-stad/broken-link-detector/./source/js/context-detector.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.initializeClientTypeChecker = initializeClientTypeChecker;\nclass ClientTypeChecker {\n    constructor(config) {\n        this.config = config;\n        this.timedOut = false;\n        this.img = new Image();\n        this.timer = null;\n        // Handle successful image load (internal client)\n        this.handleImageLoad = () => {\n            if (!this.timedOut) {\n                this.clearTimer();\n                this.setInternalClient();\n            }\n        };\n        // Handle image load error (external client)\n        this.handleImageError = () => {\n            if (!this.timedOut) {\n                this.clearTimer();\n                this.setExternalClient();\n            }\n        };\n        this.initializeCheck();\n    }\n    // Initialize the client type check\n    initializeCheck() {\n        const storedResult = sessionStorage.getItem('brokenLinkClientType');\n        if (storedResult) {\n            this.applyStoredResult(storedResult);\n        }\n        else {\n            this.setTimer();\n            this.loadImage();\n        }\n    }\n    // Apply a stored result\n    applyStoredResult(result) {\n        if (result === 'internal') {\n            this.setInternalClient();\n        }\n        else if (result === 'external') {\n            this.setExternalClient();\n        }\n    }\n    // Set a timeout for image loading\n    setTimer() {\n        this.timer = window.setTimeout(() => {\n            this.timedOut = true;\n            this.cancelImageLoad();\n            this.setExternalClient();\n        }, this.config.checkTimeout);\n    }\n    // Load the image and handle success or failure\n    loadImage() {\n        this.img.onload = this.handleImageLoad;\n        this.img.onerror = this.handleImageError;\n        this.img.src = this.config.checkUrl;\n    }\n    // Clear the timer if image loads or errors before timeout\n    clearTimer() {\n        if (this.timer) {\n            clearTimeout(this.timer);\n            this.timer = null;\n        }\n    }\n    // Cancel image loading on timeout\n    cancelImageLoad() {\n        this.img.src = ''; // Cancel image loading\n    }\n    // Mark as internal client\n    setInternalClient() {\n        document.dispatchEvent(new CustomEvent('brokenLinkContextDetectionInternal'));\n        document.body.classList.add(this.config.successClass);\n        sessionStorage.setItem('brokenLinkClientType', 'internal');\n    }\n    // Mark as external client\n    setExternalClient() {\n        // Execute custom event\n        document.dispatchEvent(new CustomEvent('brokenLinkContextDetectionExternal'));\n        document.body.classList.add(this.config.failedClass);\n        this.applyDomainRestrictions();\n        sessionStorage.setItem('brokenLinkClientType', 'external');\n    }\n    // Apply domain restrictions to domains in the domain list\n    applyDomainRestrictions() {\n        this.config.domains.forEach(domain => {\n            const elements = document.querySelectorAll(`a[href*=\"${domain}\"]`);\n            elements.forEach(element => {\n                this.addUnavailableClass(element);\n                this.preventDefaultOnClick(element);\n                if (this.config.isToolTipActive) {\n                    this.addTooltip(element);\n                }\n                if (this.config.isModalActive) {\n                    this.addModalAttributes(element);\n                }\n            });\n        });\n        this.reindexModals();\n    }\n    addUnavailableClass(element) {\n        element.classList.add('broken-link-detector-link-is-unavailable');\n    }\n    preventDefaultOnClick(element) {\n        element.addEventListener(\"click\", (event) => {\n            event.preventDefault();\n        });\n    }\n    addTooltip(element) {\n        element.setAttribute(\"data-tooltip\", this.config.tooltip);\n    }\n    addModalAttributes(element) {\n        element.setAttribute(\"data-open\", \"modal-broken-link\");\n        element.addEventListener(\"click\", () => {\n            const modalButton = document.getElementById(\"modal-broken-link-button\");\n            if (modalButton) {\n                modalButton.setAttribute(\"href\", element.getAttribute(\"href\") || \"#linknotfound\");\n            }\n        });\n    }\n    reindexModals() {\n        document.dispatchEvent(new CustomEvent('reindexModals'));\n    }\n}\n// @ts-ignore Function to initialize client type checker  \nfunction initializeClientTypeChecker(brokenLinkContextDetectionData) {\n    document.addEventListener(\"DOMContentLoaded\", () => {\n        new ClientTypeChecker(brokenLinkContextDetectionData);\n    });\n}\n// @ts-ignore\ninitializeClientTypeChecker(brokenLinkContextDetectionData);\n"],"names":["ClientTypeChecker","constructor","config","this","timedOut","img","Image","timer","handleImageLoad","clearTimer","setInternalClient","handleImageError","setExternalClient","initializeCheck","storedResult","sessionStorage","getItem","applyStoredResult","setTimer","loadImage","result","window","setTimeout","cancelImageLoad","checkTimeout","onload","onerror","src","checkUrl","clearTimeout","document","dispatchEvent","CustomEvent","body","classList","add","successClass","setItem","failedClass","applyDomainRestrictions","domains","forEach","domain","querySelectorAll","element","addUnavailableClass","preventDefaultOnClick","isToolTipActive","addTooltip","isModalActive","addModalAttributes","reindexModals","addEventListener","event","preventDefault","setAttribute","tooltip","modalButton","getElementById","getAttribute","brokenLinkContextDetectionData","initializeClientTypeChecker"],"ignoreList":[],"sourceRoot":""}